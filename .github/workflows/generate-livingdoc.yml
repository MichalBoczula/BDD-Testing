name: Generate SpecFlow Living Documentation

on:
  push:
    branches:
      - Documentation
  workflow_dispatch:

jobs:
  generate-living-doc:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        ref: 'Documentation'
        token: ${{ secrets.MY_GITHUB_TOKEN }}

    - name: Setup .NET Core
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '7.0.x'  # Adjust based on your project's .NET version

    - name: Install LivingDoc CLI
      run: dotnet tool install --global SpecFlow.Plus.LivingDoc.CLI

    - name: Generate Living Documentation
      run: |
        livingdoc test-assembly BDD.AcceptanceTests.SpecFlow/bin/Debug/net7.0/BDD.AcceptanceTests.SpecFlow.dll -o LivingDoc.html

    - name: Check for changes
      id: files_changed
      run: |
        git diff --name-only | grep -v 'LivingDoc.html' > changes.txt
        if [ -s changes.txt ]; then
          echo "Changes in other files detected."
          echo "::set-output name=changes_detected::true"
        else
          echo "No changes in other files."
          echo "::set-output name=changes_detected::false"
        fi

    - name: Commit and Push Documentation
      if: steps.files_changed.outputs.changes_detected == 'true'
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add LivingDoc.html
        git commit -m "Update Living Documentation"
        git -c http.extraHeader="AUTHORIZATION: bearer ${{ secrets.MY_GITHUB_TOKEN }}" push origin Documentation
